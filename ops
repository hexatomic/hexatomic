{"version":1,"ops":[{"type":1,"author":{"id":"725ac77188b9c2093ea4100ba878cd5190f5dc34"},"timestamp":1599902453,"metadata":{"github-id":"MDU6SXNzdWU3MDAxNjEzMDY=","github-url":"https://github.com/hexatomic/hexatomic/issues/220","origin":"github"},"title":"NullPointerException when re-saving tokens added by GraphEditor","message":"**Describe the bug**\n\nA NullPointerException is thrown in the `SaltXML10Writer` when a newly created document with tokens is saved again with some additional tokens. It seems that the target object of a relation is null.\n\n```\n16:16:06.701 [main] INFO  o.c.h.c.ApplicationLifecycle -\n                Logging configured from internal configuration\n16:16:06.732 [main] DEBUG o.c.h.c.ProjectManager -\n                Starting Project Manager\n16:16:19.625 [main] DEBUG o.c.h.c.ProjectManager -\n                Adding 3 changes as checkpoint to undo list\n16:16:20.016 [main] DEBUG o.c.h.c.ProjectManager -\n                Adding 4 changes as checkpoint to undo list\n16:16:20.370 [main] DEBUG o.c.h.c.ProjectManager -\n                Adding 10 changes as checkpoint to undo list\n16:16:20.371 [main] DEBUG o.c.h.c.CorpusStructureView -\n                Selecting created document\n16:16:24.872 [main] DEBUG o.c.h.c.ProjectManager -\n                Adding 41 changes as checkpoint to undo list\n16:16:24.873 [main] DEBUG o.c.h.g.GraphEditor -\n                Received ANNOTATION_CHANGED event for changeset org.corpus_tools.hexatomic.core.undo.ChangeSet@1eca3ea7\n16:16:42.155 [main] DEBUG o.c.h.c.ProjectManager -\n                Adding 31 changes as checkpoint to undo list\n16:16:42.156 [main] DEBUG o.c.h.g.GraphEditor -\n                Received ANNOTATION_CHANGED event for changeset org.corpus_tools.hexatomic.core.undo.ChangeSet@3a3f96ab\n16:16:51.830 [main] ERROR o.c.h.c.ProjectManager -\n                Exception occured: Could not save project\njava.lang.reflect.InvocationTargetException: null\n\tat org.eclipse.jface.operation.ModalContext.run(ModalContext.java:397) ~[na:na]\n\tat org.eclipse.jface.dialogs.ProgressMonitorDialog.run(ProgressMonitorDialog.java:469) ~[na:na]\n\tat org.corpus_tools.hexatomic.core.ProjectManager.saveTo(ProjectManager.java:405) ~[na:na]\n\tat org.corpus_tools.hexatomic.core.ProjectManager.save(ProjectManager.java:473) ~[na:na]\n\tat org.corpus_tools.hexatomic.core.handlers.SaveHandler.execute(SaveHandler.java:46) ~[na:na]\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:na]\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566) ~[na:na]\n\tat org.eclipse.e4.core.internal.di.MethodRequestor.execute(MethodRequestor.java:58) ~[na:na]\n\tat org.eclipse.e4.core.internal.di.InjectorImpl.invokeUsingClass(InjectorImpl.java:318) ~[na:na]\n\tat org.eclipse.e4.core.internal.di.InjectorImpl.invoke(InjectorImpl.java:252) ~[na:na]\n\tat org.eclipse.e4.core.contexts.ContextInjectionFactory.invoke(ContextInjectionFactory.java:173) ~[na:na]\n\tat org.eclipse.e4.core.commands.internal.HandlerServiceHandler.execute(HandlerServiceHandler.java:156) ~[na:na]\n\tat org.eclipse.core.commands.Command.executeWithChecks(Command.java:488) ~[na:na]\n\tat org.eclipse.core.commands.ParameterizedCommand.executeWithChecks(ParameterizedCommand.java:487) ~[na:na]\n\tat org.eclipse.e4.core.commands.internal.HandlerServiceImpl.executeHandler(HandlerServiceImpl.java:213) ~[na:na]\n\tat org.eclipse.e4.ui.workbench.renderers.swt.HandledContributionItem.executeItem(HandledContributionItem.java:438) ~[na:na]\n\tat org.eclipse.e4.ui.workbench.renderers.swt.AbstractContributionItem.handleWidgetSelection(AbstractContributionItem.java:449) ~[na:na]\n\tat org.eclipse.e4.ui.workbench.renderers.swt.AbstractContributionItem.lambda$2(AbstractContributionItem.java:475) ~[na:na]\n\tat org.eclipse.swt.widgets.EventTable.sendEvent(EventTable.java:89) ~[na:na]\n\tat org.eclipse.swt.widgets.Display.sendEvent(Display.java:5687) ~[na:na]\n\tat org.eclipse.swt.widgets.Widget.sendEvent(Widget.java:1423) ~[na:na]\n\tat org.eclipse.swt.widgets.Display.runDeferredEvents(Display.java:4955) ~[na:na]\n\tat org.eclipse.swt.widgets.Display.readAndDispatch(Display.java:4448) ~[na:na]\n\tat org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine$5.run(PartRenderingEngine.java:1160) ~[na:na]\n\tat org.eclipse.core.databinding.observable.Realm.runWithDefault(Realm.java:338) ~[na:na]\n\tat org.eclipse.e4.ui.internal.workbench.swt.PartRenderingEngine.run(PartRenderingEngine.java:1049) ~[na:na]\n\tat org.eclipse.e4.ui.internal.workbench.E4Workbench.createAndRunUI(E4Workbench.java:155) ~[na:na]\n\tat org.eclipse.e4.ui.internal.workbench.swt.E4Application.start(E4Application.java:166) ~[na:na]\n\tat org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:203) ~[na:na]\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:137) ~[na:na]\n\tat org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:107) ~[na:na]\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:401) ~[na:na]\n\tat org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:255) ~[na:na]\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:na]\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566) ~[na:na]\n\tat org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:657) ~[org.eclipse.equinox.launcher_1.5.700.v20200207-2156.jar:na]\n\tat org.eclipse.equinox.launcher.Main.basicRun(Main.java:594) ~[org.eclipse.equinox.launcher_1.5.700.v20200207-2156.jar:na]\n\tat org.eclipse.equinox.launcher.Main.run(Main.java:1447) ~[org.eclipse.equinox.launcher_1.5.700.v20200207-2156.jar:na]\n\tat org.eclipse.equinox.launcher.Main.main(Main.java:1420) ~[org.eclipse.equinox.launcher_1.5.700.v20200207-2156.jar:na]\nCaused by: java.lang.NullPointerException: null\n\tat org.corpus_tools.salt.util.internal.persistence.SaltXML10Writer.writeRelation(SaltXML10Writer.java:646) ~[na:na]\n\tat org.corpus_tools.salt.util.internal.persistence.SaltXML10Writer.writeDocumentGraph(SaltXML10Writer.java:422) ~[na:na]\n\tat org.corpus_tools.salt.util.internal.persistence.SaltXML10Writer.writeDocumentGraph(SaltXML10Writer.java:343) ~[na:na]\n\tat org.corpus_tools.salt.util.SaltUtil.saveDocumentGraph(SaltUtil.java:609) ~[na:na]\n\tat org.corpus_tools.salt.common.impl.SDocumentImpl.saveDocumentGraph(SDocumentImpl.java:189) ~[na:na]\n\tat org.corpus_tools.hexatomic.core.ProjectManager$1.run(ProjectManager.java:343) ~[na:na]\n\tat org.eclipse.jface.operation.ModalContext$ModalContextThread.run(ModalContext.java:122) ~[na:na]\n```\n\n\n**To reproduce the bug**\nSteps to reproduce the behavior:\n1. Create new doc via \"Add\" buttons\n2. Open in Grid Editor\n3. Tokenize something\n4. Save as project somewhere\n5. Do another tokenization.\n6a. Sometimes it works and new tokens are added\n6b. Sometimes it doesn't, and then :boom: `InvocationTargetException` on Save\n\n\n**Expected behavior**\nSaving should work without throwing an exception.\n\n**Screenshots**\n\n![bug](https://user-images.githubusercontent.com/3007126/92743808-2aa4de00-f381-11ea-9bc4-ac33d85b8ddd.gif)\n\n**Desktop (please complete the following information):**\n - Operating System: Ubuntu 20.04\n - Hexatomic Version: 0.4.3\n - Java Version: [e.g. OpenJDK 8, Oracle JDK 11]\n \n\n**Additional context**\n\nThis might be related to #214","files":null}]}